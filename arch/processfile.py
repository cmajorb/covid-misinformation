#! /usr/bin/python
# coding: utf-8

import re
import time
import gzip
import csv
import os
import sys
import string
import pandas as pd


'''
from processfile import process_file
process_file('/mnt/storage/geocities/geocities-aut-csv-derivatives/webpages/part-04439-325f80ee-3749-4d6f-baec-3dc32abfb75d-c000.csv')
'''
def process_file(filepath):
    csv.field_size_limit(sys.maxsize)
    filename = os.path.basename(filepath)
    
    ids = ['http://geocities.com/azhim01/Aids.htm', 'http://www.geocities.com/aids_holisticspng/index.htm', 'http://geocities.com/Tokyo/6425/aids.htm', 'http://www.geocities.com/medipedia/17015.htm', 'http://geocities.com/aids_holisticspng/references.htm', 'http://geocities.com/HotSprings/3741/orglinks.html', 'http://geocities.com/HIV_and_AIDS/', 'http://us.geocities.com/btmbatha/aids2.html', 'http://geocities.com/WestHollywood/Heights/5010/aids.html', 'http://us.geocities.com/qapa.geo/aids.html', 'http://geocities.com/WestHollywood/5552/pagetwo.html', 'http://geocities.com/tlf_ph/network/network_archive_youthprimer.html', 'http://geocities.com/catolicas/articulos/actualidad/reports.htm', 'http://geocities.com/aids_holisticspng/series3.htm', 'http://geocities.com/mikelscott/081.htm', 'http://geocities.com/scfhivaids/homeframe.htm', 'http://geocities.com/kim1122b/AIDS.html', 'http://geocities.com/laineberman/aids_indonesia04.htm', 'http://geocities.com/tonawaparn/report.html', 'http://geocities.com/WestHollywood/5552/linksfor.htm', 'http://geocities.com/osduy_ngo/data.html', 'http://geocities.com/anionegraton/SouthPark.html', 'http://geocities.com/cuperuspe/webquest.html', 'http://geocities.com/oklarain/rainbowoct.html', 'http://www.hanmat.org/store/confident/golf/club/aids_crisis_in_africa.htm?t=rUepln-S9eIKEwjdi7vk0t6dAhUfH4cKHUdgECkQAhgBIAsw0--gAzgxUNPvoANQpPmYD1CJ76gQUOfh-BBQmt_5EFD50r8VUNvKkdkB&slt=8&slr=12&lpt=2', 'http://asia.geocities.com/sabljak007/AIDS11.htm', 'http://geocities.com/HotSprings/Villa/7435/internet.htm', 'http://geocities.com/athens/acropolis/9254/july01.html', 'http://geocities.com/HotSprings/3741/scilinks_en.html', 'http://www.geocities.com/aids_holisticspng/national_letters.htm', 'http://geocities.com/tlf_ph/network/network_health_aidsnews1207.html', 'http://geocities.com/doriendetombe/detombehandbook2003.html', 'http://geocities.com/ylhawks/Unresolved_World_ProblemsProject-aids.htm', 'http://geocities.com/johnpotterat/Newsarticles2-15.htm', 'http://geocities.com/ScaryAIDSFacts/', 'http://geocities.com/ashlyr1115/AshleySimpso1.html', 'http://geocities.com/Wellesley/8984/wom-aids.html', 'http://geocities.com/daveyboy_can/', 'http://www.google.ca/Top/Society/Issues/Health/Conditions_and_Diseases/Sexually_Transmitted_Diseases/AIDS/', 'http://geocities.com/popeducation/research1.html', 'http://www.geocities.com/zimbabwe_gurl/aidsedu.html', 'http://uk.geocities.com/ifeogo/religion_aids.html', 'http://geocities.com/guntoroutamadi/artikel-malam-renungan-aids.html', 'http://geocities.com/Yosemite/2772/FinalCapstone.htm', 'http://geocities.com/larrynjanet/disslarrych7', 'http://geocities.com/weinerap/duaids.htm', 'http://geocities.com/a280872/UA-AIDS.htm', 'http://geocities.com/dishdisho/aids.html', 'http://poz.com/', 'http://www.geocities.com/prostar_pendang/info_aids.html', 'http://geocities.com/otagogaily/back_issues/issue_58.htm', 'http://geocities.com/lisagarmire/Chp5WorksCited.htm', 'http://disabilityuk.com/masterpages/hiv/index.html', 'http://geocities.com/flippyflop3/testofhearts13.html', 'http://geocities.com/t_dambra/Statistics.html', 'http://geocities.com/chateau_gov/AIDS.html', 'http://us.geocities.com/marissa2/aidsresources.html', 'http://www.geocities.com/livhorg/PartnersResources.html', 'http://geocities.com/newsthai/week1800.html', 'http://geocities.com/afreval/documents/health_section.htm', 'http://geocities.com/deoshlok/aids.htm', 'http://www.aidslondon.com/', 'http://geocities.com/tlf_ph/network/network_archive_hivabtest.html', 'http://geocities.com/lamorena4rmsd/howaidsisspread.html', 'http://geocities.com/valestarplace/aidslinks.html', 'http://geocities.com/shireelyn/fight/fight.html', 'http://geocities.com/tlf_ph/network/network_health_aidsnews1205.html', 'http://geocities.com/mikelscott/035.htm', 'http://geocities.com/WestHollywood/2118/eaids2.html', 'http://www.drugabuse.gov/drugpages/HIV.html', 'http://us.geocities.com/pwacoalition/13-jail.htm', 'http://www.geocities.com/vampiricstudies/medical.html', 'http://geocities.com/opendoors_stl/links.htm', 'http://geocities.com/WestHollywood/4479/rainbo_resources.html', 'http://geocities.com/CapeCanaveral/Lab/1378/HIV_n_AIDS.html', 'http://geocities.com/HotSprings/9999/aidsandstdsresearches2tr.html', 'http://geocities.com/adrianchanwp/', 'http://geocities.com/msm_nopoliticalagenda/Pride03/Links.htm', 'http://geocities.com/gayankara/turkaids.htm', 'http://geocities.com/msm_nopoliticalagenda/WorldAIDS02/1.2.Programme.htm', 'http://geocities.com/HotSprings/5243/poster.htm', 'http://geocities.com/ninquiry2004/wanda/learning_activity.html', 'http://geocities.com/aidsprojectmpow/index.html', 'http://geocities.com/touchdpy/LinksPage.htm', 'http://geocities.com/WestHollywood/Castro/1521/aids.html', 'http://www.google.com.br/Top/Society/Issues/Health/Conditions_and_Diseases/Sexually_Transmitted_Diseases/AIDS/Workplace/', 'http://geocities.com/cspslibrary/seminars2002.html', 'http://geocities.com/TimesSquare/Lair/1217/aids-mulher.html', 'http://geocities.com/aids_youth/youth.html', 'http://uk.geocities.com/l0ox82d854/aids-impotence.html', 'http://geocities.com/Heartland/Pond/9005/TributeToDavid.html', 'http://us.geocities.com/quackwatch/hiv-aids.html', 'http://geocities.com/SouthBeach/Lagoon/2222/aids.htm', 'http://www.sonnyandmike.com/sonnytellsbrendastonehasaids95.htm', 'http://geocities.com/4birthing/HIV_Fact_Sheet_Chart.htm', 'http://geocities.com/vacune_hiv/acurarme7.html', 'http://geocities.com/queencaz2002/AIDSMAIN.html', 'http://geocities.com/bourbonstreet/porch/5017/aids.html', 'http://us.geocities.com/sciresquran/Articles/Quran_and_Scientific_Research.htm', 'http://geocities.com/sebaya01/Aids2.htm', 'http://geocities.com/Tokyo/Subway/6541/thang08-nam99/VN-new_AIDS_treatment.html', 'http://www.geocities.com/youth4sa/cubagays.html', 'http://geocities.com/herbal_hiv/Fag1.htm', 'http://geocities.com/lamorena4rmsd/howaidsstarted.html', 'http://geocities.com/vdcounsel/QUESTIONSandANSWERS.html', 'http://geocities.com/lizahayes23/magic-johnson-aids-story.html', 'http://geocities.com/elvis8377/What_is_AIDS_HIV_Hemophilia.html', 'http://geocities.com/SouthBeach/Pier/8747/Aids2.html', 'http://geocities.com/HotSprings/3741/newslinks_en.html', 'http://geocities.com/doriendetombe/detombecompramh8thesis.html', 'http://geocities.com/sigma_tf/HIV-AIDS.html']
    #ids = ['http://geocities.com/azhim01/Aids.html', 'http://www.geocities.com/aids_holisticspng/index.html', 'http://geocities.com/Tokyo/6425/aids.html', 'http://www.geocities.com/medipedia/17015.html', 'http://geocities.com/aids_holisticspng/references.html', 'http://geocities.com/HotSprings/3741/orglinks.html', 'http://geocities.com/HIV_and_AIDS/', 'http://us.geocities.com/btmbatha/aids2.html', 'http://geocities.com/WestHollywood/Heights/5010/aids.html', 'http://us.geocities.com/qapa.geo/aids.html', 'http://geocities.com/WestHollywood/5552/pagetwo.html', 'http://geocities.com/tlf_ph/network/network_archive_youthprimer.html', 'http://geocities.com/catolicas/articulos/actualidad/reports.html', 'http://geocities.com/aids_holisticspng/series3.html', 'http://geocities.com/mikelscott/081.html', 'http://geocities.com/scfhivaids/homeframe.html', 'http://geocities.com/kim1122b/AIDS.html', 'http://geocities.com/laineberman/aids_indonesia04.html', 'http://geocities.com/tonawaparn/report.html', 'http://geocities.com/WestHollywood/5552/linksfor.html', 'http://geocities.com/osduy_ngo/data.html', 'http://geocities.com/anionegraton/SouthPark.html', 'http://geocities.com/cuperuspe/webquest.html', 'http://geocities.com/oklarain/rainbowoct.html', 'http://www.hanmat.org/store/confident/golf/club/aids_crisis_in_africa.html?t=rUepln-S9eIKEwjdi7vk0t6dAhUfH4cKHUdgECkQAhgBIAsw0--gAzgxUNPvoANQpPmYD1CJ76gQUOfh-BBQmt_5EFD50r8VUNvKkdkB&slt=8&slr=12&lpt=2', 'http://asia.geocities.com/sabljak007/AIDS11.html', 'http://geocities.com/HotSprings/Villa/7435/internet.html', 'http://geocities.com/athens/acropolis/9254/july01.html', 'http://geocities.com/HotSprings/3741/scilinks_en.html', 'http://www.geocities.com/aids_holisticspng/national_letters.html', 'http://geocities.com/tlf_ph/network/network_health_aidsnews1207.html', 'http://geocities.com/doriendetombe/detombehandbook2003.html', 'http://geocities.com/ylhawks/Unresolved_World_ProblemsProject-aids.html', 'http://geocities.com/johnpotterat/Newsarticles2-15.html', 'http://geocities.com/ScaryAIDSFacts/', 'http://geocities.com/ashlyr1115/AshleySimpso1.html', 'http://geocities.com/Wellesley/8984/wom-aids.html', 'http://geocities.com/daveyboy_can/', 'http://www.google.ca/Top/Society/Issues/Health/Conditions_and_Diseases/Sexually_Transmitted_Diseases/AIDS/', 'http://geocities.com/popeducation/research1.html', 'http://www.geocities.com/zimbabwe_gurl/aidsedu.html', 'http://uk.geocities.com/ifeogo/religion_aids.html', 'http://geocities.com/guntoroutamadi/artikel-malam-renungan-aids.html', 'http://geocities.com/Yosemite/2772/FinalCapstone.html', 'http://geocities.com/larrynjanet/disslarrych7', 'http://geocities.com/weinerap/duaids.html', 'http://geocities.com/a280872/UA-AIDS.html', 'http://geocities.com/dishdisho/aids.html', 'http://poz.com/', 'http://www.geocities.com/prostar_pendang/info_aids.html', 'http://geocities.com/otagogaily/back_issues/issue_58.html', 'http://geocities.com/lisagarmire/Chp5WorksCited.html', 'http://disabilityuk.com/masterpages/hiv/index.html', 'http://geocities.com/flippyflop3/testofhearts13.html', 'http://geocities.com/t_dambra/Statistics.html', 'http://geocities.com/chateau_gov/AIDS.html', 'http://us.geocities.com/marissa2/aidsresources.html', 'http://www.geocities.com/livhorg/PartnersResources.html', 'http://geocities.com/newsthai/week1800.html', 'http://geocities.com/afreval/documents/health_section.html', 'http://geocities.com/deoshlok/aids.html', 'http://www.aidslondon.com/', 'http://geocities.com/tlf_ph/network/network_archive_hivabtest.html', 'http://geocities.com/lamorena4rmsd/howaidsisspread.html', 'http://geocities.com/valestarplace/aidslinks.html', 'http://geocities.com/shireelyn/fight/fight.html', 'http://geocities.com/tlf_ph/network/network_health_aidsnews1205.html', 'http://geocities.com/mikelscott/035.html', 'http://geocities.com/WestHollywood/2118/eaids2.html', 'http://www.drugabuse.gov/drugpages/HIV.html', 'http://us.geocities.com/pwacoalition/13-jail.html', 'http://www.geocities.com/vampiricstudies/medical.html', 'http://geocities.com/opendoors_stl/links.html', 'http://geocities.com/WestHollywood/4479/rainbo_resources.html', 'http://geocities.com/CapeCanaveral/Lab/1378/HIV_n_AIDS.html', 'http://geocities.com/HotSprings/9999/aidsandstdsresearches2tr.html', 'http://geocities.com/adrianchanwp/', 'http://geocities.com/msm_nopoliticalagenda/Pride03/Links.html', 'http://geocities.com/gayankara/turkaids.html', 'http://geocities.com/msm_nopoliticalagenda/WorldAIDS02/1.2.Programme.html', 'http://geocities.com/HotSprings/5243/poster.html', 'http://geocities.com/ninquiry2004/wanda/learning_activity.html', 'http://geocities.com/aidsprojectmpow/index.html', 'http://geocities.com/touchdpy/LinksPage.html', 'http://geocities.com/WestHollywood/Castro/1521/aids.html', 'http://www.google.com.br/Top/Society/Issues/Health/Conditions_and_Diseases/Sexually_Transmitted_Diseases/AIDS/Workplace/', 'http://geocities.com/cspslibrary/seminars2002.html', 'http://geocities.com/TimesSquare/Lair/1217/aids-mulher.html', 'http://geocities.com/aids_youth/youth.html', 'http://uk.geocities.com/l0ox82d854/aids-impotence.html', 'http://geocities.com/Heartland/Pond/9005/TributeToDavid.html', 'http://us.geocities.com/quackwatch/hiv-aids.html', 'http://geocities.com/SouthBeach/Lagoon/2222/aids.html', 'http://www.sonnyandmike.com/sonnytellsbrendastonehasaids95.html', 'http://geocities.com/4birthing/HIV_Fact_Sheet_Chart.html', 'http://geocities.com/vacune_hiv/acurarme7.html', 'http://geocities.com/queencaz2002/AIDSMAIN.html', 'http://geocities.com/bourbonstreet/porch/5017/aids.html', 'http://us.geocities.com/sciresquran/Articles/Quran_and_Scientific_Research.html', 'http://geocities.com/sebaya01/Aids2.html', 'http://geocities.com/Tokyo/Subway/6541/thang08-nam99/VN-new_AIDS_treatment.html', 'http://www.geocities.com/youth4sa/cubagays.html', 'http://geocities.com/herbal_hiv/Fag1.html', 'http://geocities.com/lamorena4rmsd/howaidsstarted.html', 'http://geocities.com/vdcounsel/QUESTIONSandANSWERS.html', 'http://geocities.com/lizahayes23/magic-johnson-aids-story.html', 'http://geocities.com/elvis8377/What_is_AIDS_HIV_Hemophilia.html', 'http://geocities.com/SouthBeach/Pier/8747/Aids2.html', 'http://geocities.com/HotSprings/3741/newslinks_en.html', 'http://geocities.com/doriendetombe/detombecompramh8thesis.html', 'http://geocities.com/sigma_tf/HIV-AIDS.html']

    df = pd.read_csv(filepath, header=None, error_bad_lines=False)
    source = df[df[1].str.contains('|'.join(ids))]
    dest = df[df[2].str.contains('|'.join(ids))]
    output = pd.concat([source, dest])
    if len(output.index) > 0:
        output.to_csv("results2/" + filename)
    #Get text from selected files
    '''
    with open(filepath, 'rt') as f:
        reader = csv.reader((line.replace('\0','') for line in f), delimiter=",")
        for row in reader:
            try:
                if row[2] in ids:
                    with open("/home/cmbrow38/covid-misinformation/arch/results/"+ filename, "a") as output:
                        output.write(row[0] + ',https://web.archive.org/web/20091027/'  + row[2] + '","' + row[6] +  '"\n')
            except ValueError:
                pass
    
        #search for key words
        
        for row in reader:
            try:
                total_count = []
                processed_string = row[6].lower().translate(str.maketrans(string.punctuation,' '*len(string.punctuation))).split()
                for keyword in keywords:
                    count = processed_string.count(keyword)
                    total_count.append(count)
                if sum(total_count) > 0:
                    with open("/home/cmbrow38/covid-misinformation/arch/results/"+ filename, "a") as output:
                        output.write(row[0] + ',"https://web.archive.org/web/20091027/'  + row[2] + '",' + ','.join(str(e) for e in total_count) +  "\n")
            except ValueError:
                pass
        '''